<!DOCTYPE html>
<html>
<head>
  <title>Budget & Expense Tracker</title>
  <style>
    body { font-family: 'Arial', sans-serif; background-color: #f0f2f5; margin: 0; padding: 20px; }
    .container { max-width: 900px; margin: auto; background-color: #fff; border-radius: 8px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); padding: 25px; }
    h1 { color: #333; text-align: center; margin-bottom: 20px; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { padding: 12px; text-align: left; border-bottom: 1px solid #ddd; }
    th { background-color: #e9ecef; color: #555; font-weight: bold; }
    tr:hover { background-color: #f5f5f5; }
    .status-message { text-align: center; margin-top: 20px; color: #666; }
    .spent { font-weight: bold; }
    .over-budget { color: #d9534f; }
    .under-budget { color: #5cb85c; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Budget & Expense Tracker 📊</h1>
    <div id="status" class="status-message">Loading data...</div>
    <div id="data-table" style="display: none;">
      <table>
        <thead>
          <tr>
            <th>Category</th>
            <th>Monthly Budget</th>
            <th>Monthly Spent</th>
            <th>YTD Budget</th>
            <th>YTD Spent</th>
          </tr>
        </thead>
        <tbody id="expense-table-body"></tbody>
      </table>
    </div>
  </div>

  <script>
    // ⚠️ IMPORTANT: Replace this URL with your deployed Google Apps Script web app URL
    const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyi0QdAyHSb4tv1ba0aIF9Il5TrKqkfEnSaoDig9ICDj8mkiwL6sw9DVWjhh6QeHqGJ/exec';

    async function loadData() {
      const statusElement = document.getElementById('status');
      statusElement.textContent = 'Loading data...';
      try {
        const response = await fetch(APPS_SCRIPT_URL);
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        const data = await response.json();
        
        if (data.error) {
          throw new Error(data.error);
        }

        renderData(data);
      } catch (error) {
        showError(error.message);
      }
    }

function renderData(data) {
      const statusElement = document.getElementById('status');
      const tableBody = document.getElementById('expense-table-body');
      
      statusElement.style.display = 'none';
      document.getElementById('data-table').style.display = 'block';
      tableBody.innerHTML = '';

      data.forEach(item => {
        // Use toLocaleString with options to handle both commas and decimal places
        const formattedMonthlyBudget = item.monthlyBudget.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        const formattedMonthlySpent = item.monthlySpent.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        const formattedYtdBudget = item.ytdBudget.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        const formattedYtdSpent = item.ytdSpent.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });

        const row = document.createElement('tr');
        
        const monthlySpentClass = item.monthlySpent > item.monthlyBudget ? 'over-budget' : 'under-budget';
        const ytdSpentClass = item.ytdSpent > item.ytdBudget ? 'over-budget' : 'under-budget';

        row.innerHTML = `
          <td>${item.category}</td>
          <td>$${formattedMonthlyBudget}</td>
          <td class="spent ${monthlySpentClass}">$${formattedMonthlySpent}</td>
          <td>$${formattedYtdBudget}</td>
          <td class="spent ${ytdSpentClass}">$${formattedYtdSpent}</td>
        `;
        tableBody.appendChild(row);
      });
    }

    function showError(message) {
      const statusElement = document.getElementById('status');
      statusElement.textContent = 'Error: ' + message;
      statusElement.style.color = '#dc354f';
      console.error(message);
    }
    
    document.addEventListener('DOMContentLoaded', loadData);
  </script>
</body>
</html>